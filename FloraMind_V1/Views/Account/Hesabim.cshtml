@model EditProfileViewModel

@section Styles {
    <link rel="stylesheet" href="~/css/Hesabim.css" asp-append-version="true" />
}

<div class="profile-layout">
    @* SOL TARAF *@
    <aside class="profile-sidebar">
        <div class="sidebar-card">
            <div class="profile-avatar">@Model.Name.Substring(0, 1).ToUpper()</div>
            <h3 class="user-name">@Model.Name</h3>
            <span class="user-role-badge">@Model.Role</span>
            <div class="user-stats">
                <div class="stat-item">
                    <span class="stat-value">@Model.PlantCount</span>
                    <span class="stat-label">Bitki</span>
                </div>
            </div>
            <div class="sidebar-footer">
                <p>Üyelik: @Model.RegistrationDate.ToString("dd MMMM yyyy")</p>
            </div>
        </div>
    </aside>

    @* SAĞ TARAF *@
    <main class="profile-main-content">

        @* BİLDİRİM MESAJLARI *@
        @if (TempData["SuccessMessage"] != null)
        {
            <div class="alert-box success">
                <span class="icon">✔</span> @TempData["SuccessMessage"]
            </div>
        }
        @if (TempData["ErrorMessage"] != null)
        {
            <div class="alert-box error">
                <span class="icon">✖</span> @TempData["ErrorMessage"]
            </div>
        }

        @* GÖRÜNTÜLEME PANELİ *@
        <div id="viewPanel" class="settings-card shadow-sm">
            <div class="card-header-flex">
                <h4>Profil Bilgilerim</h4>
                <button type="button" class="btn-outline-primary" onclick="toggleEdit(true)">Bilgilerimi Değiştir</button>
            </div>
            <hr />
            <div class="info-grid">
                <div class="info-row">
                    <span class="info-label">Ad Soyad:</span>
                    <span class="info-value">@Model.Name</span>
                </div>
                <div class="info-row">
                    <span class="info-label">E-posta:</span>
                    <span class="info-value">@Model.Email</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Son Güncelleme:</span>
                    @* Veritabanından gelen LastLoginDate veya varsa LastUpdateDate bilgisini basıyoruz *@
                    <span class="info-value">@(Model.LastUpdateDate?.ToString("dd.MM.yyyy HH:mm") ?? "Henüz güncellenmedi")</span>
                </div>
            </div>
        </div>

        @* DÜZENLEME PANELİ *@
        <div id="editPanel" class="settings-card shadow-sm" style="display:none;">
            <div class="card-header">
                <h4>Profilini Düzenle</h4>
                <p class="text-muted">Kişisel bilgilerinizi ve şifrenizi güncelleyin.</p>
            </div>

            <form asp-action="Hesabim" method="post">
                <div class="form-section">
                    <div class="input-group">
                        <label asp-for="Name">Ad Soyad</label>
                        <input asp-for="Name" class="form-control" />
                    </div>
                    <div class="input-group">
                        <label asp-for="Email">E-posta</label>
                        <input asp-for="Email" class="form-control" />
                    </div>
                </div>

                <div class="form-section security-box">
                    <h5>Şifre Güvenliği</h5>
                    <div class="input-group">
                        <label>Mevcut Şifre</label>
                        <input asp-for="OldPassword" type="password" placeholder="Onay için zorunludur" />
                    </div>
                    <div class="input-group">
                        <label>Yeni Şifre</label>
                        <input asp-for="NewPassword" type="password" placeholder="Yeni şifrenizi belirleyin" />
                    </div>
                    <div class="input-group">
                        <label>Yeni Şifre (Tekrar)</label>
                        <input asp-for="ConfirmNewPassword" type="password" placeholder="Yeni şifreyi tekrar yazın" />
                    </div>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn-primary">Değişiklikleri Kaydet</button>
                    <button type="button" class="btn-secondary" onclick="toggleEdit(false)">İptal</button>
                </div>
            </form>
        </div>
    </main>
</div>

<script>
    function toggleEdit(isEditing) {
        const viewPanel = document.getElementById('viewPanel');
        const editPanel = document.getElementById('editPanel');

        if (isEditing) {
            viewPanel.style.display = 'none';
            editPanel.style.display = 'block';
        } else {
            viewPanel.style.display = 'block';
            editPanel.style.display = 'none';
        }
    }
</script>